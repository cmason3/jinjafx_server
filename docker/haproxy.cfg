global
  log stdout format raw local0 notice
  user haproxy
  group haproxy
  maxconn 4096

  ssl-default-bind-ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256
  ssl-default-bind-ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256
  ssl-default-bind-options no-sslv3 no-tlsv10 no-tlsv11 no-tls-tickets
  ssl-default-bind-curves X25519:P-256

defaults
  log global
  option log-health-checks
  option http-server-close
  option forwardfor
  option redispatch
  option splice-auto
  option socket-stats
  retries 3
  timeout http-request 10s
  timeout queue 1m
  timeout connect 10s
  timeout client 1m
  timeout server 1m
  timeout http-keep-alive 10s
  timeout check 3s
  mode http

frontend fe_http
  bind ipv4@:80 name ipv4
  bind ipv6@:80 name ipv6
  redirect scheme https code 301

frontend fe_https
  bind ipv4@:443 ssl crt /usr/local/etc/haproxy/fullchain.pem alpn h2,http/1.1 allow-0rtt name ipv4
  bind ipv6@:443 ssl crt /usr/local/etc/haproxy/fullchain.pem alpn h2,http/1.1 allow-0rtt name ipv6
  bind quic4@:443 ssl crt /usr/local/etc/haproxy/fullchain.pem alpn h3 allow-0rtt name quic4
  bind quic6@:443 ssl crt /usr/local/etc/haproxy/fullchain.pem alpn h3 allow-0rtt name quic6
  http-response set-header Strict-Transport-Security 'max-age=63072000'
  http-response set-header Alt-Svc 'h3=":443"; ma=86400'
  stats uri /stats
  default_backend be_http

backend be_http
  option httpchk GET /ping
  http-check expect string OK
  server default 127.0.0.1:8080 check
